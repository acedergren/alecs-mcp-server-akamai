# v1.7.0 SNOW LEOPARD MASTER PLAN
## True Simplification Through Systematic Excellence

> **Snow Leopard Philosophy**: "No new features, just refinement"  
> **CODE KAI Execution**: Perfect implementation over rushed delivery  
> **Result**: 189 tools ‚Üí 30 tools, 3 architectures ‚Üí 1 unified approach

---

## üéØ STRATEGIC SYNTHESIS

### Key Insights from Deep Analysis

After analyzing 6 comprehensive documents, the path to "True Snow Leopard" is clear:

1. **MASSIVE DEDUPLICATION REQUIRED**: 189 tools across 3 competing architectures must become 25-30 focused tools
2. **CLAUDE OPTIMIZATION CRITICAL**: 15-20 tools per server gives optimal Claude Desktop performance 
3. **SINGLE SERVER ACHIEVABLE**: User preference for simplicity can be honored through profile-based loading
4. **HIDDEN VALUE EXISTS**: 40+ implemented but unexposed functions need to be surfaced
5. **TYPE SAFETY TRANSFORMATION**: Zero `any` types required through CODE KAI methodology

### Architecture Resolution

**RECONCILING REQUIREMENTS**:
- User wants: Single server (operational simplicity)
- Claude needs: ‚â§20 tools (performance optimization)  
- Code needs: Massive deduplication (maintainability)

**SOLUTION**: Single server with intelligent profile-based tool loading

---

## üèóÔ∏è UNIFIED ARCHITECTURE

### Single Server, Domain-Based Profiles

```typescript
// src/index.ts - Universal Entry Point
interface DomainConfig {
  property: PropertyDomainTools;    // CDN property management
  dns: DNSDomainTools;             // DNS zone and record management  
  certificate: CertificateDomainTools; // SSL/TLS certificate lifecycle
  security: SecurityDomainTools;   // Network lists, WAF, DDoS protection
  analytics: AnalyticsDomainTools; // Reporting and monitoring
}

// Dynamic loading based on ALECS_DOMAINS environment variable
// npm start                           ‚Üí All domains (30 tools)
// ALECS_DOMAINS=property,dns npm start ‚Üí Property + DNS only (18 tools)
// ALECS_DOMAINS=property npm start     ‚Üí Property only (12 tools)
```

### Domain-Driven Tool Organization

```
src/tools/
‚îú‚îÄ‚îÄ property/       # CDN Property Management Domain (12 tools)
‚îÇ   ‚îú‚îÄ‚îÄ lifecycle.ts        # create, get, list, clone, delete
‚îÇ   ‚îú‚îÄ‚îÄ versions.ts         # version management, rollback
‚îÇ   ‚îú‚îÄ‚îÄ activation.ts       # activate, status, cancel
‚îÇ   ‚îú‚îÄ‚îÄ rules.ts           # rule configuration, validation
‚îÇ   ‚îú‚îÄ‚îÄ hostnames.ts       # hostname management, edge hostnames
‚îÇ   ‚îî‚îÄ‚îÄ infrastructure.ts   # groups, contracts, products, search
‚îÇ
‚îú‚îÄ‚îÄ dns/            # DNS Management Domain (8 tools)
‚îÇ   ‚îú‚îÄ‚îÄ zones.ts           # zone CRUD, DNSSEC, bulk operations
‚îÇ   ‚îú‚îÄ‚îÄ records.ts         # record CRUD, validation, migration
‚îÇ   ‚îî‚îÄ‚îÄ advanced.ts        # changelist workflow, monitoring
‚îÇ
‚îú‚îÄ‚îÄ certificate/    # Certificate Lifecycle Domain (5 tools)
‚îÇ   ‚îú‚îÄ‚îÄ enrollment.ts      # DV enrollment, CPS integration
‚îÇ   ‚îú‚îÄ‚îÄ validation.ts      # DNS challenges, monitoring
‚îÇ   ‚îî‚îÄ‚îÄ deployment.ts      # property integration, status
‚îÇ
‚îú‚îÄ‚îÄ security/       # Security & Protection Domain (3 tools)
‚îÇ   ‚îú‚îÄ‚îÄ network-lists.ts   # IP/Geo blocking, threat intelligence
‚îÇ   ‚îî‚îÄ‚îÄ purge.ts          # FastPurge, cache invalidation
‚îÇ
‚îú‚îÄ‚îÄ analytics/      # Reporting & Monitoring Domain (2 tools)
‚îÇ   ‚îú‚îÄ‚îÄ reports.ts         # traffic, performance, usage
‚îÇ   ‚îî‚îÄ‚îÄ monitoring.ts      # health checks, alerts
‚îÇ
‚îî‚îÄ‚îÄ REMOVE: 
    - 3 competing architectures (workflow/consolidated/individual)
    - 15 duplicate server files
    - 180+ scattered individual tools
```

---

## üìã IMPLEMENTATION PHASES

### PHASE 1: EMERGENCY DEDUPLICATION (Week 1)
**Goal**: Quick wins through obvious duplicate removal

```bash
# IMMEDIATE ACTIONS (CODE KAI Diet Plan Phase 1)
‚úÖ DELETE: src/tools/universal-search-simplified.ts
‚úÖ CLEAN: Deprecated functions from registry (upsertRecord)  
‚úÖ REMOVE: Development artifacts (-backup, -old, -temp files)
‚úÖ VERIFY: Zero TypeScript compilation errors

# EXPECTED RESULT: 5-10 tools removed, cleaner codebase
```

### PHASE 2: FUNCTION CONSOLIDATION (Week 2)  
**Goal**: Merge duplicate implementations

```typescript
// CONSOLIDATE DUPLICATE FUNCTIONS
‚ùå REMOVE: cancelPropertyActivation (property-manager-advanced-tools.ts:658)
‚úÖ KEEP: cancelPropertyActivation (property-activation-advanced.ts:911) - Enhanced

‚ùå REMOVE: searchProperties (3 different implementations)
‚úÖ KEEP: Universal search (single, cached implementation)

// MERGE BASIC/ENHANCED PAIRS
‚úÖ MERGE: createEdgeHostname + createEdgeHostnameEnhanced
‚úÖ MERGE: listPropertyVersions + listPropertyVersionsEnhanced  
‚úÖ MERGE: createPropertyVersion + createPropertyVersionEnhanced

// EXPECTED RESULT: 15-25 tools removed, consolidated functionality
```

### PHASE 3: SINGLE SERVER ARCHITECTURE (Week 3)
**Goal**: Implement domain-based loading

```typescript
// src/index.ts - Domain-Based Tool Registry
class DomainBasedServer {
  private toolRegistry = new Map<string, ToolDefinition>();
  
  async loadDomains(domains: string[]) {
    // Load tools based on domain selection
    for (const domain of domains) {
      await this.loadDomain(domain);
    }
  }
  
  private async loadDomain(domain: string) {
    // Lazy load domain-specific tools
    const domainTools = await import(`./tools/${domain}`);
    this.registerDomainTools(domain, domainTools);
  }
}

// DOMAIN CONFIGURATIONS
const DOMAIN_CONFIGS = {
  property: {
    toolFiles: ['lifecycle', 'versions', 'activation', 'rules', 'hostnames', 'infrastructure'],
    toolCount: 12,
    memoryTarget: '<25MB'
  },
  dns: {
    toolFiles: ['zones', 'records', 'advanced'],
    toolCount: 8,
    memoryTarget: '<15MB'
  },
  certificate: {
    toolFiles: ['enrollment', 'validation', 'deployment'],
    toolCount: 5,
    memoryTarget: '<10MB'
  },
  security: {
    toolFiles: ['network-lists', 'purge'],
    toolCount: 3,
    memoryTarget: '<8MB'
  },
  analytics: {
    toolFiles: ['reports', 'monitoring'],
    toolCount: 2,
    memoryTarget: '<5MB'
  }
};

// USAGE EXAMPLES
// ALECS_DOMAINS=property,dns ‚Üí Property + DNS domains (20 tools, ~40MB)
// ALECS_DOMAINS=property ‚Üí Property only (12 tools, ~25MB)  
// ALECS_DOMAINS=dns,certificate ‚Üí DNS + Certificates (13 tools, ~25MB)
```

### PHASE 4: TYPE SAFETY TRANSFORMATION (Week 4)
**Goal**: Apply CODE KAI principles systematically

```typescript
// CODE KAI METHODOLOGY (55 minutes per function)
// 1. Research & Analysis (10 min) - Study official Akamai API docs
// 2. Type Definition (15 min) - Create precise interfaces  
// 3. Implementation (20 min) - Type-safe implementation
// 4. Testing & Validation (10 min) - Live API testing

// DAILY TARGET: 2-4 functions perfectly implemented
// WEEKLY TARGET: 10-20 functions completed
// QUALITY GATES: Zero `any` types, runtime validation, live API tests

// EXAMPLE TRANSFORMATION:
// BEFORE: response = await client.request(...) as unknown
// AFTER: 
interface PropertyListResponse {
  properties: {
    items: Array<{
      propertyId: string;
      propertyName: string;
      contractId: string;
      groupId: string;
      latestVersion: number;
      productionVersion?: number;
      stagingVersion?: number;
    }>;
  };
}

function isPropertyListResponse(obj: unknown): obj is PropertyListResponse {
  return obj !== null && typeof obj === 'object' && 'properties' in obj;
}

const response = await client.request(config);
if (!isPropertyListResponse(response)) {
  throw new Error('Invalid API response structure');
}
// Now response is fully typed and validated
```

### PHASE 5: CLAUDE OPTIMIZATION & TESTING (Week 5)
**Goal**: Perfect Claude Desktop integration

```typescript
// CLAUDE OPTIMIZATION IMPLEMENTATION

// 1. JSON-FIRST RESPONSE PATTERN
interface StandardToolResponse<T> {
  data: T;                    // Main response data
  metadata: {
    total: number;            // Total items available
    shown: number;            // Items in this response  
    hasMore: boolean;         // More items available
    executionTime: number;    // Response time in ms
    warnings?: string[];      // Non-fatal issues
  };
  filters?: Record<string, any>;     // Applied filters echoed
  parameters?: Record<string, any>;  // Input parameters echoed
}

// 2. TOOL NAMING STANDARDIZATION (Claude pattern matching)
‚úÖ GOOD (consistent hierarchy):
- property_create, property_version_create, property_activation_create
- dns_zone_create, dns_record_create  
- cert_enroll, cert_validate

‚ùå BAD (inconsistent patterns):  
- create_property, new_property_version, make_edge_hostname

// 3. PROGRESSIVE PARAMETER DISCLOSURE  
{
  "name": "property_create",
  "description": "Create a new CDN property configuration",
  "parameters": {
    "required": ["name"],  // Only essential parameters required
    "properties": {
      "name": { "type": "string", "description": "Property name" },
      "contract_id": { "description": "Contract ID (auto-detected if not provided)" },
      "group_id": { "description": "Group ID (auto-detected if not provided)" }
    }
  }
}

// 4. RESPONSE SIZE OPTIMIZATION
if (responseSize > MAX_RESPONSE_SIZE) {
  return {
    "data": null,
    "summary": extractKeySummary(fullData),
    "notice": "Full data too large. Use specific filters or request details.",
    "suggested_queries": [
      "property_get id='prp_12345'",
      "property_search name='specific-name'"
    ]
  };
}
```

---

## üéØ DOMAIN-BASED TOOL SPECIFICATIONS

### PROPERTY DOMAIN (12 tools) - CDN Management
```typescript
// LIFECYCLE MANAGEMENT (5 tools)
- property_list              // List all properties with filtering
- property_get               // Get detailed property information
- property_create            // Create new CDN property
- property_clone             // Clone existing property configuration
- property_delete            // Remove property (with safety checks)

// VERSION & ACTIVATION (3 tools)
- property_version_create    // Create new property version
- property_activate          // Activate version to staging/production
- property_rollback          // Emergency rollback to previous version

// CONFIGURATION (2 tools)
- property_rules_get         // Get property rule configuration
- property_rules_update      // Update property rules safely

// HOSTNAME MANAGEMENT (1 tool)
- property_hostname_manage   // Add/remove/list hostnames for property

// INFRASTRUCTURE (1 tool)
- property_infrastructure    // Groups, contracts, products, search

// MEMORY TARGET: ~25MB, TOOLS: 12
```

### DNS DOMAIN (8 tools) - DNS Management
```typescript
// ZONE MANAGEMENT (4 tools)
- dns_zone_list              // List DNS zones with filtering
- dns_zone_create            // Create new DNS zone
- dns_zone_update            // Update zone settings and SOA
- dns_zone_delete            // Remove DNS zone safely

// RECORD MANAGEMENT (3 tools)
- dns_record_manage          // CRUD operations for DNS records
- dns_record_bulk            // Bulk record operations with validation
- dns_record_migrate         // Migration tools from other providers

// ADVANCED OPERATIONS (1 tool)
- dns_changelist_workflow    // Changelist-based DNS operations

// MEMORY TARGET: ~15MB, TOOLS: 8
```

### CERTIFICATE DOMAIN (5 tools) - SSL/TLS Lifecycle
```typescript
// ENROLLMENT & PROVISIONING (2 tools)
- cert_enroll_dv             // Enroll Default DV certificates
- cert_enroll_cps            // CPS certificate management

// VALIDATION & MONITORING (2 tools)
- cert_validate              // DNS challenge validation
- cert_monitor               // Certificate status monitoring

// DEPLOYMENT (1 tool)
- cert_deploy                // Property integration and deployment

// MEMORY TARGET: ~10MB, TOOLS: 5
```

### SECURITY DOMAIN (3 tools) - Protection & Control
```typescript
// NETWORK PROTECTION (2 tools)
- security_network_lists     // IP/Geo blocking, threat intelligence
- security_purge             // FastPurge cache invalidation

// MONITORING (1 tool)
- security_monitor           // Security event monitoring

// MEMORY TARGET: ~8MB, TOOLS: 3
```

### ANALYTICS DOMAIN (2 tools) - Insights & Monitoring
```typescript
// REPORTING (1 tool)
- analytics_reports          // Traffic, performance, usage reports

// MONITORING (1 tool)  
- analytics_monitor          // Health checks, alerts, dashboards

// MEMORY TARGET: ~5MB, TOOLS: 2
```

---

## üöÄ SUCCESS METRICS & VALIDATION

### Quantitative Targets

```typescript
// TOOL COUNT REDUCTION
BEFORE: 189 tools across 3 architectures
AFTER:  30 tools maximum (84% reduction)

// CLAUDE PERFORMANCE OPTIMIZATION (Domain-Based)
PROPERTY ONLY: 12 tools (optimal Claude performance, <120ms decision time)
PROPERTY+DNS: 20 tools (good Claude performance, <200ms decision time)
ALL DOMAINS: 30 tools (acceptable Claude performance, <300ms decision time)

// MEMORY EFFICIENCY (Domain-Based)
PROPERTY: ~25MB (single domain focus)
DNS: ~15MB (lightweight DNS operations)
CERTIFICATE: ~10MB (certificate lifecycle only)
PROPERTY+DNS: ~40MB (most common combination)
ALL DOMAINS: ~63MB (comprehensive but efficient)

// TYPE SAFETY TRANSFORMATION
BEFORE: Unknown number of `any` types, inconsistent validation
AFTER: Zero `any` types, 100% runtime validation coverage

// WORKFLOW COMPLETENESS
EXPOSE: 40+ hidden but implemented functions
ENABLE: Complete property onboarding, certificate setup, emergency rollback
```

### Qualitative Improvements

```typescript
// USER EXPERIENCE
‚úÖ Tool Discovery: Clear core ‚Üí standard ‚Üí full upgrade path
‚úÖ Response Quality: 100% JSON responses optimized for Claude
‚úÖ Error Handling: Actionable error messages with next steps
‚úÖ Documentation: Complete examples for all tools

// DEVELOPER EXPERIENCE  
‚úÖ Mental Model: Single server, profile-based loading
‚úÖ Code Quality: Perfect type safety through CODE KAI
‚úÖ Maintainability: Organized structure, zero duplication
‚úÖ Testing: Live API validation for every function

// OPERATIONAL EXCELLENCE
‚úÖ Deployment: Single server simplicity
‚úÖ Scaling: Profile-based resource optimization
‚úÖ Monitoring: Clear metrics and health checks
‚úÖ Performance: Sub-second startup for core profile
```

---

## üõ°Ô∏è RISK MITIGATION & ROLLBACK STRATEGY

### Phase-by-Phase Safety

```bash
# PHASE 1: ZERO RISK - Only removing obvious duplicates
- Git branch: feat/phase-1-deduplication
- Rollback: Simple git checkout main
- Impact: Immediate cleanup, no functional changes

# PHASE 2: LOW RISK - Merging duplicate functions  
- Git branch: feat/phase-2-consolidation
- Testing: Comprehensive unit tests before merge
- Rollback: Revert specific commits

# PHASE 3: MEDIUM RISK - Architecture change
- Git branch: feat/phase-3-architecture  
- Feature flags: Enable profile loading gradually
- Rollback: Environment variable change

# PHASE 4: MEDIUM RISK - Type safety transformation
- Git branch: feat/phase-4-type-safety
- Function-by-function implementation
- Rollback: Individual function revert possible

# PHASE 5: LOW RISK - Claude optimization
- Git branch: feat/phase-5-claude-optimization
- Response format enhancement only
- Rollback: Response formatter changes
```

### Validation Gates

```typescript
// EACH PHASE COMPLETION REQUIRES:
‚úÖ Zero TypeScript compilation errors
‚úÖ All existing tests pass
‚úÖ Live API tests pass for affected functions  
‚úÖ Memory usage within target bounds
‚úÖ Claude Desktop integration verified
‚úÖ Documentation updated
‚úÖ Performance benchmarks met
```

---

## üéØ IMMEDIATE NEXT STEPS

### Week 1: START CODE KAI DIET PHASE 1 (READY TO EXECUTE)

```bash
# IMMEDIATE SAFE ACTIONS (10 minutes, zero risk)

# 1. Remove inferior duplicate
rm src/tools/universal-search-simplified.ts

# 2. Clean deprecated functions  
# Update src/tools/all-tools-registry.ts - remove upsertRecord registration

# 3. Verify no development artifacts
find src -name "*-backup.ts" -o -name "*-old.ts" -o -name "*-temp.ts"

# 4. Validate changes
npm run typecheck
npm run build

# EXPECTED RESULT: 2-5 tools removed, cleaner codebase, zero functional impact
```

### NPM Script Updates for Domain-Based Loading

```json
// package.json scripts section
{
  "start": "node dist/index.js",
  "start:property": "ALECS_DOMAINS=property node dist/index.js",
  "start:dns": "ALECS_DOMAINS=dns node dist/index.js", 
  "start:certificate": "ALECS_DOMAINS=certificate node dist/index.js",
  "start:property-dns": "ALECS_DOMAINS=property,dns node dist/index.js",
  "start:minimal": "ALECS_DOMAINS=property node dist/index.js",
  "start:full": "ALECS_DOMAINS=property,dns,certificate,security,analytics node dist/index.js"
}
```

### Week 1: CREATE MASTER TRACKING

```markdown
## v1.7.0 Snow Leopard Progress Dashboard

### PHASE 1: Emergency Deduplication
- [ ] Remove universal-search-simplified.ts
- [ ] Clean deprecated upsertRecord  
- [ ] Remove development artifacts
- [ ] Validate zero compilation errors

### PHASE 2: Function Consolidation  
- [ ] Merge cancelPropertyActivation variants
- [ ] Consolidate search implementations
- [ ] Merge basic/enhanced tool pairs
- [ ] Update all imports and references

### PHASE 3: Single Server Architecture
- [ ] Implement profile-based loading
- [ ] Create tool organization structure
- [ ] Add lazy loading pattern
- [ ] Update NPM scripts

### PHASE 4: Type Safety Transformation (CODE KAI)
- [ ] Core tools: property lifecycle (5 functions)
- [ ] Core tools: infrastructure support (3 functions)  
- [ ] Core tools: DNS essentials (3 functions)
- [ ] Core tools: certificate basics (2 functions)
- [ ] Core tools: emergency operations (2 functions)

### PHASE 5: Claude Optimization & Testing
- [ ] JSON response pattern implementation
- [ ] Tool naming standardization
- [ ] Response size optimization  
- [ ] End-to-end workflow validation
```

---

## üéâ TRANSFORMATION VISION

**FROM**: 189-tool monster with 3 competing architectures, inconsistent types, scattered functionality

**TO**: 30-tool precision instrument with single unified architecture, perfect type safety, Claude-optimized performance

**EMBODYING**: True Snow Leopard philosophy - no new features, just systematic refinement to perfection

This master plan transforms ALECS from complexity to simplicity, from confusion to clarity, from scattered implementation to focused excellence - achieving the Snow Leopard ideal through CODE KAI precision.

---

*Master Plan Status: ‚úÖ READY FOR EXECUTION*  
*Next Action: Begin Phase 1 Emergency Deduplication*  
*Expected Completion: 5 weeks to Snow Leopard perfection*